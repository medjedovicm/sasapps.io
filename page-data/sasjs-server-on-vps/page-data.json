{"componentChunkName":"component---src-templates-template-tsx","path":"/sasjs-server-on-vps","result":{"data":{"site":{"meta":{"title":"SAS Apps - Unleash Your Analytics","description":"Custom Interfaces to the world's most powerful Analytics Platform","siteUrl":"https://sasapps.io","author":"Allan Bowe","twitter":"","adsense":""}},"post":{"id":"c07b3adf-70cc-5635-9ecb-d0356096bc9b","html":"<p><a href=\"https://server.sasjs.io\">SASjs Server</a> is the latest addition to the <a href=\"https://sasjs.io\">SASjs</a> product family, and closes an important gap - namely, the ability to perform DevOps and launch applications on regular Foundation (desktop or server, windows or linux) SAS.</p>\n<p>This guide will show you how to install and configure SASjs on a VPS (Virtual Private Server), such as a Digital Ocean droplet.</p>\n<h2>Introduction</h2>\n<p>Like all <a href=\"https://github.com/sasjs\">SASjs tools</a>, SASjs Server is MIT open source and hence completely free for commercial use.  The latest release is always available on the <a href=\"https://github.com/sasjs/server/releases\">github releases</a> page.  The major features are:</p>\n<ul>\n<li>Portal for 3rd Party Apps (AppStream)</li>\n<li>Permissions by User or Group</li>\n<li>Multiple runtimes (SAS, JS)</li>\n<li>Online IDE (Studio)</li>\n<li>Stored Programs</li>\n<li>REST API</li>\n<li>TLS</li>\n</ul>\n<p>One of the (many) nice things about SASjs Server is that it is extremely lightweight!  You can even run it on a $6 VPS, as shown here::</p>\n<div class=\"gatsby-resp-iframe-wrapper\" style=\"padding-bottom: 56.25%; position: relative; height: 0; overflow: hidden; margin-bottom: 1.0725rem\" > <iframe src=\"https://www.youtube.com/embed/aYufNmHLmBs\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen=\"\" style=\" position: absolute; top: 0; left: 0; width: 100%; height: 100%; \"></iframe> </div>\n<p>In this guide we show you exactly how to create a server image like the one above.  If you are planning multiple users, you might want to consider a slightly higher spec!  We have a dozen or so users on our $28 per month image, plus all our test suites, and the performance has been great.</p>\n<h2>Pre-Requisites</h2>\n<p>Before you get started, be sure you can obtain the following:</p>\n<ul>\n<li>The IP address of your VPS, with root SSH access, eg: <code class=\"language-text\">167.44.44.44</code></li>\n<li>A copy of SAS (or WPS) and the corresponding licence key</li>\n<li>A domain (and access to the DNS panel), eg <code class=\"language-text\">mysas.mycompany.com</code></li>\n<li>A MongoDB connection string (you can provision one locally or use a free cloud instance)</li>\n</ul>\n<h2>Server Setup</h2>\n<p>Let’s get this machine configured! First we log in as root, eg:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># Enter as root using YOUR new server IP address</span>\n<span class=\"token function\">ssh</span> root@167.44.44.44</code></pre></div>\n<p>Next, we create a unix group (<code class=\"language-text\">sas</code>) and create the system user account / home directory:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># Create a sas group</span>\naddgroup sas\n<span class=\"token comment\"># Make the user account (eg sasjssrv)</span>\nadduser --disabled-password --gecos <span class=\"token string\">\"\"</span> sasjssrv\n<span class=\"token comment\"># Add to `sas` group</span>\nadduser sasjssrv sas</code></pre></div>\n<h2>SAS Installation</h2>\n<p>This part will vary depending on your service provider.  Follow the necessary instructions to install the basic software suite. You do NOT need any products beyond the basic SAS executable (<code class=\"language-text\">sas.exe</code> / <code class=\"language-text\">sas.sh</code>).</p>\n<h2>TLS</h2>\n<p>Before proceeding with TLS (SSL) it is necessary to first update your DNS and add an “A record” pointing to your server IP.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; margin-bottom: 1.0725rem;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.42553191489361%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABCUlEQVQoz52SS07EMBBEc2puwgFG4gwsuQLrEQuEYmaIEzuJlcTxL4XLEDQgoRG01ItuW1Wv266EEGiaBj9j27Z/ZTUMA5RSWJYF8zxjHEdYa8thSunPWXnvi4jWuggaM2Jd118pr0VFMgpO0wTnHGKMCCGARnuyds5nh4CjMLg5POPxSeMkXlDXArJf8KYtzOxRkarruiJISu6TJgyK7wYcJyPChYSzdlh9gs8AnMbnnst1jOlDkIR930NKmUc2RYDZtm0xYI+kMYsKUUN1MpvOWcyVNfHu18g7BZ32Q9LsZCGGbw/EtfhPQ9Y0snaBMg5yzCOzebnsa9/i8h6DlFq+4u6hxu39Ce9G4m+sfghkYQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"sasjs server dns\"\n        title=\"sasjs server dns\"\n        src=\"/static/3f359fdd06abf3c58f48a9b8a727986c/1d69c/sasjs_server_dns.png\"\n        srcset=\"/static/3f359fdd06abf3c58f48a9b8a727986c/4dcb9/sasjs_server_dns.png 188w,\n/static/3f359fdd06abf3c58f48a9b8a727986c/5ff7e/sasjs_server_dns.png 375w,\n/static/3f359fdd06abf3c58f48a9b8a727986c/1d69c/sasjs_server_dns.png 750w,\n/static/3f359fdd06abf3c58f48a9b8a727986c/78797/sasjs_server_dns.png 1125w,\n/static/3f359fdd06abf3c58f48a9b8a727986c/aa440/sasjs_server_dns.png 1500w,\n/static/3f359fdd06abf3c58f48a9b8a727986c/bfe41/sasjs_server_dns.png 2082w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>Once this is done, we can generate https certificates using <code class=\"language-text\">certbot</code> as follows:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">snap <span class=\"token function\">install</span> core<span class=\"token punctuation\">;</span> snap refresh core\nsnap <span class=\"token function\">install</span> --classic certbot\n<span class=\"token function\">ln</span> -s /snap/bin/certbot /usr/bin/certbot\n<span class=\"token comment\"># provide domain to terminal prompt WITHOUT https prefix, eg mysas.mycompany.com</span>\n<span class=\"token function\">sudo</span> certbot certonly --standalone\n\n<span class=\"token comment\"># ensure members of the sas group can access the certs</span>\n<span class=\"token comment\"># update the paths below according to the actual domain!</span>\n<span class=\"token function\">mkdir</span> /opt/certificates\n<span class=\"token builtin class-name\">cd</span> /etc/letsencrypt/live/YOURDOMAIN.com\n<span class=\"token function\">cp</span> fullchain.pem /opt/certificates/fullchain.pem\n<span class=\"token function\">cp</span> privkey.pem /opt/certificates/privkey.pem\n<span class=\"token function\">chgrp</span> -R sas /opt/certificates\n<span class=\"token function\">chmod</span> -R g+r /opt/certificates</code></pre></div>\n<h2>SASjs Installation &#x26; Configuration</h2>\n<p>Here’s the exciting part - the SASjs config!  The instructions below provide a FULL deployment, including TLS / server mode / JS runtime option.  If any part of this is not relevant for your use case, you can simply omit it.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># change into the folder.  Remain as root to keep files protected.</span>\n<span class=\"token builtin class-name\">cd</span> /home/sasjssrv\n\n<span class=\"token comment\"># grab latest api server</span>\n<span class=\"token function\">curl</span> -L https://github.com/sasjs/server/releases/latest/download/linux.zip <span class=\"token operator\">></span> linux.zip\n<span class=\"token comment\"># unzip can be installed with `apt install unzip`</span>\n<span class=\"token function\">unzip</span> linux.zip\n\n<span class=\"token comment\"># Tell SASjs the location of your SAS executable</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"SAS_PATH=/path/to/your/sas.sh\"</span> <span class=\"token operator\">></span> .env\n<span class=\"token comment\"># At this point you can already stop, and you</span>\n<span class=\"token comment\"># will have SASjs Server in desktop mode!</span>\n\n\n<span class=\"token comment\"># If you would also like the option of a JS runtime, follow these steps:</span>\n<span class=\"token function\">curl</span> -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.3/install.sh <span class=\"token operator\">|</span> <span class=\"token function\">bash</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">NVM_DIR</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token environment constant\">$HOME</span>/.nvm\"</span>\n<span class=\"token punctuation\">[</span> -s <span class=\"token string\">\"<span class=\"token variable\">$NVM_DIR</span>/nvm.sh\"</span> <span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">\\</span>. <span class=\"token string\">\"<span class=\"token variable\">$NVM_DIR</span>/nvm.sh\"</span>  <span class=\"token comment\"># This loads nvm</span>\n<span class=\"token punctuation\">[</span> -s <span class=\"token string\">\"<span class=\"token variable\">$NVM_DIR</span>/bash_completion\"</span> <span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">\\</span>. <span class=\"token string\">\"<span class=\"token variable\">$NVM_DIR</span>/bash_completion\"</span>  <span class=\"token comment\"># This loads nvm bash_completion</span>\nnvm <span class=\"token function\">install</span> --lts\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"NODE_PATH=<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">which</span> node<span class=\"token variable\">)</span></span>\"</span> <span class=\"token operator\">>></span> .env\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"PYTHON_PATH=<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">which</span> python3<span class=\"token variable\">)</span></span>\"</span> <span class=\"token operator\">>></span> .env\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"RUN_TIMES=sas,js,py\"</span> <span class=\"token operator\">>></span> .env\n\n<span class=\"token comment\"># Server Mode enables Users, Groups &amp; Permissions</span>\n<span class=\"token comment\"># But requires a Mongo DB connx string</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"MODE=server\"</span> <span class=\"token operator\">>></span> .env\n<span class=\"token comment\"># DB connection string</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"DB_CONNECT=mongodb+srv://admin:admin@cluster0.YOURINSTANCE.mongodb.net/sasjs?retryWrites=true&amp;w=majority\"</span> <span class=\"token operator\">>></span> .env\n\n<span class=\"token comment\"># For https, point at the certs generated previously</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"PORT=443\"</span> <span class=\"token operator\">>></span> .env\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"PROTOCOL=https\"</span> <span class=\"token operator\">>></span> .env\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"CERT_CHAIN=/opt/certificates/fullchain.pem\"</span> <span class=\"token operator\">>></span> .env\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"PRIVATE_KEY=/opt/certificates/privkey.pem\"</span> <span class=\"token operator\">>></span> .env\n\n<span class=\"token comment\"># enable api-linux to run on port 443</span>\n<span class=\"token comment\"># re-run whenever SASjs Server is re-installed</span>\nsetcap <span class=\"token string\">'cap_net_bind_service=+ep'</span> /home/sasjssrv/api-linux\n\n<span class=\"token comment\"># Create a handy refresh script to update SASjs Server</span>\n<span class=\"token function\">cat</span> <span class=\"token operator\">></span> refreshSASjs.sh <span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">EOL\n#bin/bash\ncurl -L https://github.com/sasjs/server/releases/latest/download/linux.zip > linux.zip\nunzip -o linux.zip\nsetcap 'cap_net_bind_service=+ep' /home/sasjssrv/api-linux\nEOL</span>\n<span class=\"token function\">chmod</span> <span class=\"token number\">774</span> refreshSASjs.sh</code></pre></div>\n<p>That’s the setup. Now, the launch - using the designated system account.  Be aware that anyone running code or Stored Programs will be executing under this OS identity.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># switch to system user</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">su</span> - sasjssrv\n<span class=\"token comment\"># launch SASjs Server</span>\n<span class=\"token function\">nohup</span> ./api-linux <span class=\"token operator\">></span> server.log <span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span><span class=\"token file-descriptor important\">&amp;1</span> <span class=\"token operator\">&amp;</span></code></pre></div>\n<p>You should now be able to access SASjs Server at your domain, eg <code class=\"language-text\">mysas.mycompany.com</code> using the default credentials (<code class=\"language-text\">secretuser</code>/<code class=\"language-text\">secretpassword</code>).  If there are problems connecting, check out the logs in the <code class=\"language-text\">/home/sasjssrv/sasjs_root/logs</code> directory.</p>\n<h2>Create the SASjs Users</h2>\n<p>Users can be added manually using the rest api, or in bulk using SASjs Studio - here is some sample code!</p>\n<div class=\"gatsby-highlight\" data-language=\"sas\"><pre class=\"language-sas\"><code class=\"language-sas\"><span class=\"token step keyword\">data</span> work<span class=\"token punctuation\">.</span>users<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">infile</span> cards dsd<span class=\"token punctuation\">;</span>\n  input username:<span class=\"token punctuation\">$</span><span class=\"token number\">12</span><span class=\"token punctuation\">.</span> displayname:<span class=\"token punctuation\">$</span><span class=\"token number\">32</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">;</span>\n  putlog _all_<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">call</span> <span class=\"token function keyword\">execute</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">'%nrstr(%ms_createuser('</span><span class=\"token operator\">!!</span>username<span class=\"token operator\">!!</span><span class=\"token string\">',demo123,displayname='</span><span class=\"token operator\">!!</span>displayname<span class=\"token operator\">!!</span><span class=\"token string\">'))'</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ncards4<span class=\"token punctuation\">;</span>\nsylvester<span class=\"token punctuation\">,</span>Sylvester Stallone\nrocky<span class=\"token punctuation\">,</span>Rocky Balboa\njohn<span class=\"token punctuation\">,</span>John Johnston\n<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span>\n<span class=\"token step keyword\">run</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function keyword\">%ms_getusers</span><span class=\"token punctuation\">(</span>outds<span class=\"token operator\">=</span>work<span class=\"token punctuation\">.</span>users<span class=\"token punctuation\">)</span>\n\n<span class=\"token function keyword\">%mp_ds2md</span><span class=\"token punctuation\">(</span>work<span class=\"token punctuation\">.</span>users<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Finally - don’t forget to change the password for the secretuser, and request that other users do the same for theirs.</p>\n<p>If you’d like to perform additional configuration, just update the <a href=\"https://server.sasjs.io/settings/\">name / value pairs</a> in the <code class=\"language-text\">/home/sasjssrv/.env</code> file and restart the server.</p>","frontmatter":{"title":"SASjs Server on Cloud VPS","featuredImage":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAABYlAAAWJQFJUiTwAAADpklEQVQ4y51VS09bRxgdfK9fMdQgsB1e4eHI4mHAxkYGIh4tyIkxSI5R7VSEh4AERESxUKVSqNQFUSK6aiuxojS0ZAFRUZMNkSJWWTar/qLTez7n2oBolHRxfOeO55453/m++Ua1traipaUFXV1dCIfD8ozFYoJoNIpIJILu7m4Bxz09Pejt7ZUn13K+o6NDONra2qD4Q6JAIID6+nr4fD64XC7Y7XaBzWa7AHO+rKwM1dXVaGhoEKJQKASKUxxwN03TUFJSAqXUJ4HfOJ1O9PX1iWLV2dmJxsZGVFRUyI5USHi93ivh83lx/brXWOtDTQ1Rg9LSUomQkSqyksjc0Wq1FkK9HLbdboPFYjPWmSgqbW5uLhLW1tZ+dIjRkMJmTse3X+vI3tWNubxNN2/6i4R1dXUyOTw8jPn5eTGc7/SV/nCsa3nC1JiOf95ewzePrNj5wYZff3bgmlMZtvmNjBuEZHW73ejv78fh4SFWVlYwMjIiH09NTWFjYyNPqGvynM7oWJm3FhQ/3rQjPqxQ5WlGNBLOZ5kJYepPT08xODhYWHxycoJ37/6WsNyfKXS1W/DLUzsSoxq+SuvILVmx+6MDtz9X8HgNwmg4n2XWHwkY+tHREZaXl6Wmjo+P8fvBb7iTyCA+pPDquQtv/nTiblLD4rSO1y8c2Fq3o9qnUH/Dj8j5kAcGBpBMJqXy9/f3sbOzg7OzM0PlCzw7eIm5ewrpcatRBQqlrhI8nLEilbQVk+J/nxSG7PF4pMZ2d3ext7cnRbq9vY3y8nJZvPX9E9zPNuCvPzS0BnQE/AovD3XDgmL2/SYhQzazfBUsFsv7sYZQUGH/J4PsuQ+DtyoR7o4hm/1SiGgbz7qUDavd/Jj4ryPocFbh9p2EQTKFYEcMS0sPMDMzg1wuJ4S0SxReLmySskEw8/F4HJOTk9JRRke/wNramkG0ZFhUhdnZWUxMTMj/LLX29va8QvpHAhY021Y6nZbWxZrkYhKMj4+LEgrY3PxOCIaGhuTcUwTnpTmwPNjfVldXRc3CwoKUDW0gYTabxdzcHJqamrC+vi4nh14xCTxJZlT8X0ImIbOayWQwNjYmagganUqlRDkjYEf5UNKKWTa8YZYTiQQWFxeFlOBuuq5fUHGexEycSXih25CwsrKycGL+Dwr9kJmhGpLxTNMjh8Mh/Y8KTZWE+c6eSdCOGqNCSEYOuVPoIQec4A7m5WReWCyXYDAo4Ni8zHhtEDxp5n1C/AupioIAnG3bfwAAAABJRU5ErkJggg==","width":240,"height":265,"src":"/static/80428fcead9e5f0817fcc890dbccf234/2b087/sasjs_server.png","srcSet":"/static/80428fcead9e5f0817fcc890dbccf234/2b087/sasjs_server.png 1x"}}},"path":"/sasjs-server-on-vps","category":"SASjs Server","tags":["SASjs","SASjs Server","SAS Admin","SAS"],"description":"A complete guide to Installation & Configuration of SASjs Server on a VPS (Digital Ocean)","date":"2022/07/18"}}},"pageContext":{}}}